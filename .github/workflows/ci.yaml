name: CI

on:
  workflow_call:
  push:

env:
  TZ: Europe/Paris

jobs:
  checks:
    name: "Checks"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        job: [check, build, "lint", "test"]
    steps:
      - uses: actions/checkout@v5

      - name: Setup bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: 1.3.0

      - name: Install dependencies
        run: bun install --frozen-lockfile --ignore-scripts

      - name: Sync routes
        run: bun x kit-routes sync

      - name: Run '${{ matrix.job }}' command ðŸ§ª
        run: bun --bun run ${{ matrix.job }}

  # docker:
  #   runs-on: ubuntu-latest
  #   name: "Docker build"
  #   steps:
  #     - uses: actions/checkout@v5

  #     - name: Set up QEMU
  #       uses: docker/setup-qemu-action@v3

  #     - name: Set up Docker Buildx
  #       uses: docker/setup-buildx-action@v3

  #     - name: Docker image info
  #       run: docker images dashlit:latest

  #     - name: Docker build with load
  #       run: docker buildx build --load -t dashlit:latest .
  #       timeout-minutes: 2

  #     - shell: bash
  #       name: Docker dry run
  #       run: |
  #         docker run --rm dashlit:latest bun --version
